<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="${post.title}">상세</title>
  <style>
    .container{max-width:960px;margin:32px auto;padding:0 16px;font-family:system-ui,Arial}
    .toolbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:12px 0 8px}
    button, input[type="submit"]{font:inherit;appearance:none;-webkit-appearance:none}
    a.btn, button.btn, input[type="submit"].btn,
    a.btn:link, a.btn:visited{
      display:inline-block;padding:8px 14px;border:1px solid #d1d5db;border-radius:6px;
      text-decoration:none;color:#111827;font-weight:600;background:#fff;cursor:pointer;line-height:1.2
    }
    a.btn:hover, button.btn:hover, input[type="submit"].btn:hover{background:#f3f4f6}
    .btn-primary{border-color:#2563eb}
    .btn-primary:hover{background:#eff6ff}

    .meta{color:#6b7280;font-size:14px;margin:6px 0 16px}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:8px;padding:18px}
    .content{white-space:pre-wrap;line-height:1.6}
  </style>
</head>
<body>
  <!-- 권한 오류 플래시 메시지 -->
  <script th:if="${error}" th:inline="javascript">
    /*<![CDATA[*/ alert(/*[[${#strings.escapeJavaScript(error)}]]*/ ""); /*]]>*/
  </script>

  <div class="container" th:object="${post}">
    <div class="toolbar">
      <h1 style="margin:0;" th:text="*{title}">게시글 상세</h1>
      <div>
        <a th:href="@{/}" class="btn">메인</a>
        <a th:href="@{/posts}" class="btn">목록</a>
        <!-- 수정/삭제 노출 조건: canEdit 유지 -->
        <a th:if="${canEdit}" th:href="@{|/posts/${post.id}/edit|}" class="btn btn-primary">수정</a>
        <form th:if="${canEdit}" th:action="@{|/posts/${post.id}/delete|}" method="post" style="display:inline;">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
          <button type="submit" class="btn" onclick="return confirm('삭제하시겠습니까?');">삭제</button>
        </form>
      </div>
    </div>

    <div class="meta">
      <span th:text="${post.user != null ? post.user.username : '알수없음'}">작성자</span>
      <span>·</span>
      <span th:if="${post.createdAt}"
            th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">작성일</span>
    </div>

    <div class="card">
      <!-- XSS 방지: th:text + pre-wrap 유지 -->
      <div class="content" th:text="*{content}">내용</div>
    </div>
    <div th:if="${attachments != null and !#lists.isEmpty(attachments)}">
	  <h3>첨부파일</h3>
	  <ul>
	    <li th:each="a : ${attachments}">
	      <a th:href="@{|/attachments/${a.id}/download|}"
	         th:text="${a.originalName}">filename</a>
	      <small th:text="${#numbers.formatInteger(a.size/1024,0)} + ' KB'"></small>
	    </li>
	  </ul>
	</div>
  </div>
</body>
</html>
