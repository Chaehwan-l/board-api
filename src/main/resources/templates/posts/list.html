<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>게시글 목록</title>
  <style>
    .container{max-width:960px;margin:32px auto;padding:0 16px;font-family:system-ui,Arial}
    .toolbar{display:flex;justify-content:space-between;align-items:center;gap:12px;margin:12px 0 8px}
    .btn, .btn:link, .btn:visited, button.btn{
      display:inline-block;padding:8px 14px;border:1px solid #d1d5db;border-radius:6px;
      text-decoration:none;color:#111827;font-weight:600;background:#fff;cursor:pointer
    }
    .btn:hover{background:#f3f4f6}
    .btn-primary{border-color:#2563eb}
    .btn-primary:hover{background:#eff6ff}
    .table-wrap{overflow-x:auto;background:#fff;border:1px solid #e5e7eb;border-radius:8px}
    table.list{width:100%;border-collapse:collapse;table-layout:fixed}
    table.list thead th{background:#f9fafb;color:#6b7280;font-size:14px}
    table.list th, table.list td{padding:12px 14px;border-bottom:1px solid #eef2f7;text-align:left}
    table.list tbody tr:hover{background:#f3f4f6}
    col.col-id{width:80px}
    col.col-author{width:200px}
    .title{display:block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    button{font: inherit; appearance:none; -webkit-appearance:none}
    form.search{display:flex;gap:8px;align-items:center}
    form.search input[type="text"]{padding:8px 10px;border:1px solid #d1d5db;border-radius:6px;min-width:220px}
    form.search select{padding:8px 10px;border:1px solid #d1d5db;border-radius:6px}
    nav.pager{display:flex;gap:6px;justify-content:center;align-items:center;margin:16px 0}
    nav.pager a, nav.pager span{padding:6px 10px;border:1px solid #e5e7eb;border-radius:6px;text-decoration:none;color:#111827}
    nav.pager .active{font-weight:700;border-color:#111827}
  </style>
</head>
<body>
  <script th:if="${param.autologin}" th:inline="javascript">
    alert('기존 정보가 있어 자동 로그인했습니다.');
  </script>
  <div th:if="${loginName}">
    <p>
      <strong th:text="${loginName}"></strong>
      <span th:if="${loginEmail}">(<span th:text="${loginEmail}"></span>)</span>
      <span th:if="${loginRole}"> / 권한: <span th:text="${loginRole}"></span></span>
    </p>
    <form th:action="@{/logout}" method="post" style="display:inline;">
      <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
      <button type="submit" class="btn">로그아웃</button>
    </form>
  </div>

  <div class="container">
    <div class="toolbar">
      <h1 style="margin:0;">게시글 목록</h1>
      <div>
        <a th:href="@{/}" class="btn">메인</a>
        <a th:href="@{/posts/new}" class="btn btn-primary">새 글쓰기</a>
      </div>
    </div>

    <!-- 검색 폼 -->
    <form class="search" th:action="@{/posts}" method="get" style="margin:8px 0 16px;">
      <select name="type" th:value="${type}">
        <option value="title"  th:selected="${type}=='title'">제목</option>
        <option value="author" th:selected="${type}=='author'">작성자</option>
      </select>
      <input type="text" name="q" placeholder="검색어" th:value="${q}">
      <input type="hidden" name="size" th:value="${pageSize}">
      <button type="submit" class="btn btn-primary">검색</button>
    </form>

    <div class="table-wrap">
      <table class="list">
        <colgroup>
          <col class="col-id"/><col/><col class="col-author"/>
        </colgroup>
        <thead>
          <tr><th>번호</th><th>제목</th><th>작성자</th></tr>
        </thead>
        <tbody>
          <tr th:each="post, stat : ${posts}">
  			<td th:text="${(page.number * page.size) + stat.index + 1}">1</td>
            <td><a th:href="@{|/posts/${post.id}|}" th:text="${post.title}" class="title">제목</a></td>
            <td th:text="${post.user != null ? post.user.username : '알수없음'}">작성자</td>
          </tr>
          <tr th:if="${#lists.isEmpty(posts)}">
            <td colspan="3">게시글이 없습니다.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- 페이지네이션: 파라미터 유지 -->
    <nav class="pager" th:if="${page.totalPages > 1}">
      <a th:if="${page.hasPrevious()}"
         th:href="@{/posts(page=${page.number-1}, size=${pageSize}, type=${type}, q=${q})}">이전</a>
      <span th:each="i : ${#numbers.sequence(0, page.totalPages-1)}"
            th:classappend="${i}==${page.number} ? 'active'">
        <a th:if="${i} != ${page.number}"
           th:text="${i+1}"
           th:href="@{/posts(page=${i}, size=${pageSize}, type=${type}, q=${q})}">1</a>
        <span th:if="${i} == ${page.number}" th:text="${i+1}">1</span>
      </span>
      <a th:if="${page.hasNext()}"
         th:href="@{/posts(page=${page.number+1}, size=${pageSize}, type=${type}, q=${q})}">다음</a>
    </nav>

  </div>
</body>
</html>
